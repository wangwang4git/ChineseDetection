<template>
  <!-- è¯†å­—é‡æµ‹è¯•ç§‘å­¦åŸç†é¡µé¢ -->
  <view class="page-container">
    <!-- é¡¶éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area-top"></view>

    <!-- è¿”å›æŒ‰é’® -->
    <view class="back-btn" @tap="goBack">
      <text class="back-text">â† è¿”å›</text>
    </view>

    <!-- Header å¡ç‰‡ -->
    <view class="header-card">
      <text class="header-emoji">ğŸ”¬</text>
      <text class="header-title">è¯†å­—é‡æµ‹è¯•ç§‘å­¦åŸç†</text>
      <text class="header-subtitle">åŸºäºè¯­è¨€å­¦ç ”ç©¶çš„ç§‘å­¦æµ‹è¯„æ–¹æ³•</text>
    </view>

    <!-- å†…å®¹å¡ç‰‡åˆ—è¡¨ -->
    <view class="content-section">
      <!-- ğŸ“Š æ•°æ®æ¥æºå¡ç‰‡ -->
      <view class="info-card data-source-card">
        <view class="card-header">
          <text class="card-emoji">ğŸ“Š</text>
          <text class="card-title">æ•°æ®æ¥æº</text>
        </view>
        <view class="card-content">
          <text class="content-text">
            åŸºäºã€Šç°ä»£æ±‰è¯­å¸¸ç”¨å­—è¡¨ã€‹åŠè¯­æ–™åº“å¤§æ•°æ®ï¼Œç²¾é€‰å‰<text class="highlight-purple">2500ä¸ªå¸¸ç”¨å­—</text>ï¼Œè¿™äº›å­—åœ¨ç°ä»£æ±‰è¯­è¯­æ–™åº“ä¸­çš„å‡ºç°ç´¯ç§¯é¢‘ç‡é«˜è¾¾<text class="highlight-purple">98.5%</text>ï¼Œæ¶µç›–äº†æ—¥å¸¸ç”Ÿæ´»å’Œå­¦ä¹ ä¸­ç»å¤§éƒ¨åˆ†æ±‰å­—ä½¿ç”¨åœºæ™¯ã€‚
          </text>
        </view>
      </view>

      <!-- ğŸ¯ æµ‹è¯•ç­–ç•¥å¡ç‰‡ -->
      <view class="info-card strategy-card">
        <view class="card-header">
          <text class="card-emoji">ğŸ¯</text>
          <text class="card-title">æµ‹è¯•ç­–ç•¥</text>
        </view>
        <view class="card-content">
          <text class="content-text">
            é‡‡ç”¨<text class="highlight-green">åˆ†å±‚é¢‘ç‡æŠ½æ ·</text>æµ‹è¯•ç­–ç•¥ï¼Œæ ¹æ®æ±‰å­—ä½¿ç”¨é¢‘ç‡åˆ†ä¸º6ä¸ªå±‚çº§ï¼Œé€šè¿‡åŠ æƒè®¡ç®—å¾—å‡ºå‡†ç¡®çš„è¯†å­—é‡ä¼°ç®—ã€‚
          </text>
        </view>
        <!-- å…¬å¼å±•ç¤ºåŒºåŸŸ -->
        <view class="formula-section">
          <text class="formula-label">è¯†å­—é‡è®¡ç®—å…¬å¼</text>
          <view class="formula-box">
            <view class="formula-line">
              <text class="formula-w">W</text>
              <text class="formula-eq">=</text>
              <text class="formula-n">N</text><text class="formula-sub">L1</text>
              <text class="formula-op">+ (</text>
              <text class="formula-n">N</text><text class="formula-sub">L2</text>
              <text class="formula-op">Ã— 3) + (</text>
              <text class="formula-n">N</text><text class="formula-sub">L3</text>
              <text class="formula-op">Ã— 10) +</text>
            </view>
            <view class="formula-line">
              <text class="formula-op">(</text>
              <text class="formula-n">N</text><text class="formula-sub">L4</text>
              <text class="formula-op">Ã— 20) + (</text>
              <text class="formula-n">N</text><text class="formula-sub">L5</text>
              <text class="formula-op">Ã— 50) + (</text>
              <text class="formula-n">N</text><text class="formula-sub">L6</text>
              <text class="formula-op">Ã— 100)</text>
            </view>
          </view>
          <text class="formula-note">å…¶ä¸­ N<text class="formula-note-sub">Lx</text> ä»£è¡¨åœ¨ç¬¬ x å±‚çº§ä¸­å®é™…è®¤è¯»æ­£ç¡®çš„å­—æ•°</text>
        </view>
      </view>

      <!-- ğŸ“‹ å¸¸ç”¨å­—å±‚çº§åˆ’åˆ†å¡ç‰‡ -->
      <view class="info-card level-card">
        <view class="card-header">
          <text class="card-emoji">ğŸ“‹</text>
          <text class="card-title">å¸¸ç”¨å­—å±‚çº§åˆ’åˆ†</text>
        </view>
        <view class="card-content">
          <!-- è¡¨æ ¼ -->
          <view class="level-table">
            <!-- è¡¨å¤´ -->
            <view class="table-header">
              <view class="th th-level">å±‚çº§</view>
              <view class="th th-rank">å­—é¢‘æ’å</view>
              <view class="th th-desc">æè¿°</view>
              <view class="th th-sample">æŠ½æ ·æ–¹å¼</view>
              <view class="th th-count">æµ‹è¯•å­—æ•°</view>
              <view class="th th-weight">æƒé‡</view>
            </view>
            <!-- è¡¨æ ¼å†…å®¹ -->
            <view 
              v-for="(item, index) in levelData" 
              :key="index" 
              class="table-row"
              :class="'row-' + item.level.toLowerCase()"
            >
              <view class="td td-level">
                <text :class="'level-tag level-' + item.level.toLowerCase()">{{ item.level }}</text>
              </view>
              <view class="td td-rank">{{ item.rank }}</view>
              <view class="td td-desc">{{ item.desc }}</view>
              <view class="td td-sample">{{ item.sample }}</view>
              <view class="td td-count">
                <text class="count-text">{{ item.count }}</text>
              </view>
              <view class="td td-weight">
                <text :class="'weight-text weight-' + item.level.toLowerCase()">{{ item.weight }}</text>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- âš ï¸ æµ‹è¯•ç»“æŸæœºåˆ¶å¡ç‰‡ -->
      <view class="info-card end-card">
        <view class="card-header">
          <text class="card-emoji">âš ï¸</text>
          <text class="card-title">æµ‹è¯•ç»“æŸæœºåˆ¶</text>
        </view>
        <view class="card-content">
          <view class="end-item">
            <text class="end-bullet">â€¢</text>
            <text class="end-text">
              åœ¨ä»»ä½•ä¸€ä¸ªå±‚çº§ï¼ˆL1-L6ï¼‰ï¼Œå¦‚æœå­©å­<text class="highlight-orange">è¿ç»­5ä¸ªæµ‹è¯•å­—ä¸è®¤è¯†</text>ï¼Œç«‹å³åœæ­¢æµ‹è¯•
            </text>
          </view>
          <view class="end-item">
            <text class="end-bullet">â€¢</text>
            <text class="end-text">
              åœ¨ä»»ä½•ä¸€ä¸ªå±‚çº§ï¼Œå¦‚æœè¯¥å±‚çº§<text class="highlight-orange">æ€»é”™è¯¯ç‡è¶…è¿‡80%</text>ï¼Œç«‹å³åœæ­¢æµ‹è¯•
            </text>
          </view>
        </view>
        <view class="end-tip">
          <text class="end-tip-text">ğŸ’¡ è¿™æ ·çš„æœºåˆ¶å¯ä»¥é¿å…è®©å­©å­äº§ç”ŸæŒ«è´¥æ„Ÿï¼ŒåŒæ—¶æé«˜æµ‹è¯•æ•ˆç‡</text>
        </view>
      </view>

      <!-- ğŸ’¡ è®¡ç®—ç¤ºä¾‹å¡ç‰‡ -->
      <view class="info-card example-card">
        <view class="card-header">
          <text class="card-emoji">ğŸ’¡</text>
          <text class="card-title">è®¡ç®—ç¤ºä¾‹</text>
        </view>
        <view class="example-content">
          <!-- å‰æè¯´æ˜ -->
          <view class="example-warning">
            <text class="warning-text">âš ï¸ å‰æï¼šæµ‹è¯•è¿‡ç¨‹ä¸­å­˜åœ¨è¿ç»­5ä¸ªæµ‹è¯•å­—ä¸è®¤è¯†çš„æƒ…å†µ</text>
          </view>
          
          <!-- å‡è®¾æµ‹è¯•ç»“æœ -->
          <text class="example-label">å‡è®¾æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</text>
          <view class="example-list">
            <text class="example-item">â€¢ L1å±‚çº§ï¼šè®¤è¯† 45ä¸ªï¼ˆå…±50ä¸ªï¼‰</text>
            <text class="example-item">â€¢ L2å±‚çº§ï¼šè®¤è¯† 40ä¸ªï¼ˆå…±50ä¸ªï¼‰</text>
            <text class="example-item">â€¢ L3å±‚çº§ï¼šè®¤è¯† 20ä¸ªï¼ˆå…±30ä¸ªï¼‰</text>
            <text class="example-item">â€¢ L4å±‚çº§ï¼šè®¤è¯† 15ä¸ªï¼ˆå…±25ä¸ªï¼‰</text>
            <text class="example-item">â€¢ L5å±‚çº§ï¼šè®¤è¯† 5ä¸ªï¼ˆå…±10ä¸ªï¼‰</text>
            <text class="example-item">â€¢ L6å±‚çº§ï¼šè®¤è¯† 2ä¸ªï¼ˆå…±10ä¸ªï¼‰</text>
          </view>
          
          <!-- è®¡ç®—è¿‡ç¨‹ -->
          <text class="example-label">è®¡ç®—è¯†å­—é‡ï¼š</text>
          <view class="calc-box">
            <text class="calc-text">W = 45Ã—1 + 40Ã—3 + 20Ã—10 + 15Ã—20 + 5Ã—50 + 2Ã—100</text>
          </view>
          <view class="calc-box">
            <text class="calc-text">W = 45 + 120 + 200 + 300 + 250 + 200</text>
          </view>
          
          <!-- æœ€ç»ˆç»“æœ -->
          <view class="result-row">
            <text class="result-label">ä¼°ç®—è¯†å­—é‡ =</text>
            <text class="result-number">1115</text>
            <text class="result-unit">ä¸ªæ±‰å­—</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-area-bottom"></view>
  </view>
</template>

<script setup>
/**
 * è¯†å­—é‡æµ‹è¯•ç§‘å­¦åŸç†é¡µé¢
 * å±•ç¤ºæµ‹è¯•æ–¹æ³•çš„ç§‘å­¦ä¾æ®å’Œè®¡ç®—åŸç†
 */
import { ref, onMounted, onUnmounted } from 'vue'
// #ifdef MP-WEIXIN
import { onShareAppMessage, onShareTimeline } from '@dcloudio/uni-app'
// #endif
import { getSciencePrincipleShareConfig, getSciencePrincipleTimelineConfig } from '@/utils/share.js'
import { initAudio, playSound, destroyAudio } from '@/utils/audioManager.js'

/**
 * å±‚çº§è¡¨æ ¼æ•°æ®
 */
const levelData = ref([
  { level: 'L1', rank: '1-50', desc: 'ç»å¯¹æ ¸å¿ƒå­—', sample: 'å…¨æµ‹+éšæœºæ‰“ä¹±', count: '50å­—', weight: 'Ã—1' },
  { level: 'L2', rank: '51-200', desc: 'é«˜é¢‘åŸºç¡€å­—', sample: 'éšæœºæŠ½æ ·', count: '50å­—', weight: 'Ã—3' },
  { level: 'L3', rank: '201-500', desc: 'ä¸­é¢‘å¸¸ç”¨å­—', sample: 'éšæœºæŠ½æ ·', count: '30å­—', weight: 'Ã—10' },
  { level: 'L4', rank: '501-1000', desc: 'æ¬¡å¸¸ç”¨å­—', sample: 'éšæœºæŠ½æ ·', count: '25å­—', weight: 'Ã—20' },
  { level: 'L5', rank: '1001-1500', desc: 'ä½é¢‘æ‹“å±•å­—', sample: 'éšæœºæŠ½æ ·', count: '10å­—', weight: 'Ã—50' },
  { level: 'L6', rank: '1501-2500', desc: 'ç”Ÿåƒ»/ä¹¦é¢å­—', sample: 'éšæœºæŠ½æ ·', count: '10å­—', weight: 'Ã—100' }
])

/**
 * è¿”å›ä¸Šä¸€é¡µ
 */
const goBack = () => {
  playSound('button')
  uni.navigateBack({
    fail: () => {
      // å¦‚æœæ²¡æœ‰ä¸Šä¸€é¡µï¼Œè¿”å›é¦–é¡µ
      uni.switchTab({
        url: '/pages/home/home'
      })
    }
  })
}

// #ifdef MP-WEIXIN
/**
 * å¾®ä¿¡åˆ†äº«ç»™å¥½å‹
 * @returns {Object} åˆ†äº«é…ç½®
 */
onShareAppMessage(() => {
  return getSciencePrincipleShareConfig()
})

/**
 * å¾®ä¿¡åˆ†äº«åˆ°æœ‹å‹åœˆ
 * @returns {Object} æœ‹å‹åœˆåˆ†äº«é…ç½®
 */
onShareTimeline(() => {
  return getSciencePrincipleTimelineConfig()
})
// #endif

// åˆå§‹åŒ–éŸ³æ•ˆ
onMounted(() => {
  initAudio()
})

// é”€æ¯éŸ³æ•ˆå®ä¾‹
onUnmounted(() => {
  destroyAudio()
})
</script>

<style scoped>
/* é¡µé¢å®¹å™¨ */
.page-container {
  min-height: 100vh;
  background: linear-gradient(135deg, #FCCEE8 0%, #E9D4FF 50%, #BEDBFF 100%);
  padding: 0 32rpx;
  box-sizing: border-box;
}

/* å®‰å…¨åŒºåŸŸ */
.safe-area-top {
  height: 88rpx;
}

.safe-area-bottom {
  height: calc(48rpx + env(safe-area-inset-bottom));
}

/* è¿”å›æŒ‰é’® */
.back-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 18rpx 32rpx;
  background: rgba(255, 255, 255, 0.90);
  border-radius: 999rpx;
  border: 3rpx solid #DAB2FF;
  box-shadow: 0 8rpx 24rpx -8rpx rgba(0, 0, 0, 0.10), 0 20rpx 30rpx -6rpx rgba(0, 0, 0, 0.10);
}

.back-text {
  font-size: 32rpx;
  font-weight: 500;
  color: #6E11B0;
}

/* Header å¡ç‰‡ */
.header-card {
  margin-top: 32rpx;
  padding: 48rpx 56rpx;
  background: linear-gradient(90deg, #FDA5D5 0%, #DAB2FF 50%, #8EC5FF 100%);
  border-radius: 32rpx;
  border: 7rpx solid white;
  box-shadow: 0 8rpx 12rpx -8rpx rgba(0, 0, 0, 0.10), 0 20rpx 30rpx -6rpx rgba(0, 0, 0, 0.10);
  display: flex;
  flex-direction: column;
  align-items: center;
}

.header-emoji {
  font-size: 60rpx;
}

.header-title {
  font-size: 48rpx;
  font-weight: 500;
  color: white;
  margin-top: 16rpx;
}

.header-subtitle {
  font-size: 28rpx;
  color: rgba(255, 255, 255, 0.90);
  margin-top: 12rpx;
}

/* å†…å®¹åŒºåŸŸ */
.content-section {
  margin-top: 32rpx;
  display: flex;
  flex-direction: column;
  gap: 32rpx;
}

/* é€šç”¨ä¿¡æ¯å¡ç‰‡ */
.info-card {
  background: rgba(255, 255, 255, 0.90);
  border-radius: 32rpx;
  padding: 44rpx;
  box-shadow: 0 8rpx 12rpx -8rpx rgba(0, 0, 0, 0.10), 0 20rpx 30rpx -6rpx rgba(0, 0, 0, 0.10);
}

/* å„å¡ç‰‡è¾¹æ¡†é¢œè‰² */
.data-source-card {
  border: 3rpx solid #8EC5FF;
}

.strategy-card {
  border: 3rpx solid #7BF1A8;
}

.level-card {
  border: 3rpx solid #FDA5D5;
}

.end-card {
  border: 3rpx solid #FFDF20;
}

.example-card {
  border: 3rpx solid #A3B3FF;
}

/* å¡ç‰‡å¤´éƒ¨ */
.card-header {
  display: flex;
  align-items: center;
  margin-bottom: 24rpx;
}

.card-emoji {
  font-size: 40rpx;
}

.card-title {
  font-size: 36rpx;
  font-weight: 500;
  color: #6E11B0;
  margin-left: 16rpx;
}

/* å¡ç‰‡å†…å®¹ */
.card-content {
  /* å†…å®¹æ ·å¼ */
}

.content-text {
  font-size: 28rpx;
  color: #364153;
  line-height: 1.8;
}

/* é«˜äº®æ–‡å­— */
.highlight-purple {
  color: #9810FA;
  font-weight: 700;
}

.highlight-green {
  color: #00A63E;
  font-weight: 700;
}

.highlight-orange {
  color: #D08700;
  font-weight: 700;
}

/* å…¬å¼åŒºåŸŸ */
.formula-section {
  margin-top: 24rpx;
  padding: 32rpx;
  background: linear-gradient(135deg, #FAF5FF 0%, #FDF2F8 100%);
  border-radius: 28rpx;
  border: 3rpx solid #E9D4FF;
}

.formula-label {
  display: block;
  text-align: center;
  font-size: 24rpx;
  color: #4A5565;
  margin-bottom: 16rpx;
}

.formula-box {
  background: white;
  border-radius: 20rpx;
  padding: 24rpx 32rpx;
  box-shadow: 0 4rpx 8rpx -4rpx rgba(0, 0, 0, 0.10), 0 8rpx 12rpx -2rpx rgba(0, 0, 0, 0.10);
}

.formula-line {
  display: flex;
  flex-wrap: wrap;
  align-items: baseline;
  justify-content: center;
  line-height: 2;
}

.formula-w {
  font-size: 28rpx;
  font-weight: 700;
  color: #9810FA;
}

.formula-eq {
  font-size: 28rpx;
  color: #1E2939;
  margin: 0 8rpx;
}

.formula-n {
  font-size: 28rpx;
  color: #364153;
}

.formula-sub {
  font-size: 20rpx;
  color: #1E2939;
  vertical-align: sub;
}

.formula-op {
  font-size: 28rpx;
  color: #1E2939;
  margin: 0 4rpx;
}

.formula-note {
  display: block;
  text-align: center;
  font-size: 24rpx;
  color: #4A5565;
  margin-top: 16rpx;
}

.formula-note-sub {
  font-size: 18rpx;
  vertical-align: sub;
}

/* å±‚çº§è¡¨æ ¼ */
.level-table {
  border-radius: 16rpx;
  overflow: hidden;
}

.table-header {
  display: flex;
  background: linear-gradient(90deg, #E9D4FF 0%, #FCCEE8 100%);
}

.th {
  padding: 18rpx 8rpx;
  font-size: 24rpx;
  font-weight: 700;
  color: #6E11B0;
  text-align: center;
  border: 3rpx solid #DAB2FF;
  display: flex;
  align-items: center;
  justify-content: center;
}

.th-level { flex: 0.7; }
.th-rank { flex: 1.2; }
.th-desc { flex: 1.1; }
.th-sample { flex: 1.3; }
.th-count { flex: 0.9; }
.th-weight { flex: 0.9; }

.table-row {
  display: flex;
}

.td {
  padding: 18rpx 8rpx;
  font-size: 24rpx;
  color: #364153;
  text-align: center;
  border: 3rpx solid #E9D4FF;
  display: flex;
  align-items: center;
  justify-content: center;
  word-break: break-all;
}

.td-level { flex: 0.7; }
.td-rank { flex: 1.2; }
.td-desc { flex: 1.1; }
.td-sample { flex: 1.3; }
.td-count { flex: 0.9; }
.td-weight { flex: 0.9; }

/* å„è¡ŒèƒŒæ™¯è‰² */
.row-l1 { background: #FEF2F2; }
.row-l2 { background: #FFF7ED; }
.row-l3 { background: #FEFCE8; }
.row-l4 { background: #F0FDF4; }
.row-l5 { background: #EFF6FF; }
.row-l6 { background: #FAF5FF; }

/* å±‚çº§æ ‡ç­¾é¢œè‰² */
.level-tag {
  font-weight: 700;
}

.level-l1 { color: #E7000B; }
.level-l2 { color: #F54900; }
.level-l3 { color: #D08700; }
.level-l4 { color: #00A63E; }
.level-l5 { color: #155DFC; }
.level-l6 { color: #9810FA; }

/* æµ‹è¯•å­—æ•°é«˜äº® */
.count-text {
  color: #9810FA;
  font-weight: 700;
}

/* æƒé‡é¢œè‰² */
.weight-l1 { color: #E7000B; }
.weight-l2 { color: #F54900; }
.weight-l3 { color: #D08700; }
.weight-l4 { color: #00A63E; }
.weight-l5 { color: #155DFC; }
.weight-l6 { color: #9810FA; }

/* æµ‹è¯•ç»“æŸæœºåˆ¶ */
.end-item {
  display: flex;
  margin-bottom: 16rpx;
}

.end-bullet {
  font-size: 32rpx;
  color: #D08700;
  margin-right: 16rpx;
  flex-shrink: 0;
}

.end-text {
  font-size: 28rpx;
  color: #364153;
  line-height: 1.6;
}

.end-tip {
  margin-top: 24rpx;
  padding: 24rpx;
  background: #FEFCE8;
  border-radius: 20rpx;
  border: 3rpx solid #FFF085;
}

.end-tip-text {
  font-size: 24rpx;
  color: #4A5565;
  text-align: center;
  display: block;
}

/* è®¡ç®—ç¤ºä¾‹ */
.example-content {
  padding: 32rpx;
  background: linear-gradient(135deg, #EEF2FF 0%, #FAF5FF 100%);
  border-radius: 28rpx;
  border: 3rpx solid #C6D2FF;
}

.example-warning {
  background: #FEF9C2;
  border-radius: 20rpx;
  border: 1rpx solid #FFDF20;
  padding: 16rpx 24rpx;
  margin-bottom: 24rpx;
}

.warning-text {
  font-size: 24rpx;
  color: #364153;
  text-align: center;
  display: block;
}

.example-label {
  font-size: 28rpx;
  color: #364153;
  display: block;
  margin-bottom: 16rpx;
}

.example-list {
  margin-bottom: 24rpx;
}

.example-item {
  font-size: 24rpx;
  color: #364153;
  display: block;
  line-height: 2;
}

.calc-box {
  background: white;
  border-radius: 8rpx;
  padding: 18rpx 24rpx;
  margin-bottom: 16rpx;
}

.calc-text {
  font-size: 24rpx;
  color: #364153;
}

.result-row {
  display: flex;
  align-items: baseline;
  justify-content: center;
  margin-top: 16rpx;
}

.result-label {
  font-size: 32rpx;
  font-weight: 700;
  color: #9810FA;
}

.result-number {
  font-size: 48rpx;
  font-weight: 700;
  color: #9810FA;
  margin: 0 8rpx;
}

.result-unit {
  font-size: 32rpx;
  font-weight: 700;
  color: #9810FA;
}
</style>
