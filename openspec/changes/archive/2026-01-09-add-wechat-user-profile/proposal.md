---
title: "微信小程序用户信息管理"
status: "completed"
created: "2026-01-08"
updated: "2026-01-09"
author: "AI Assistant"
reviewers: []
---

# 微信小程序用户信息管理

## Why

当前项目使用 Mock 用户数据（`小朋友`、`👦`、`user_001`），缺乏真实的用户身份识别。为了提升用户体验并为后续的云端数据同步奠定基础，需要实现完整的微信用户信息管理功能。

根据微信小程序最新的头像昵称填写规范，需要实现：

1. **用户身份识别**：通过 OpenID 唯一标识用户
2. **头像昵称管理**：遵循微信规范，使用头像昵称填写组件
3. **隐私保护**：OpenID 显示时需要掩码处理
4. **本地存储**：用户信息本地持久化，暂不同步云端

## What Changes

### 新增功能

1. **OpenID 获取**：应用启动时自动获取用户 OpenID
2. **头像选择**：个人页点击头像触发微信头像选择组件
3. **昵称填写**：个人页点击昵称区域触发微信昵称填写组件
4. **信息展示**：个人页展示用户头像、昵称和掩码后的 OpenID
5. **本地存储**：用户信息持久化到本地存储，支持离线访问
6. **用户引导**：首次进入个人页时显示操作引导提示

### 不包含的功能

- 云端数据同步（后续迭代）
- 用户登录/注册流程
- 用户权限管理
- 多用户切换

## 价值主张

- **用户体验**：真实的用户身份和个性化信息
- **合规性**：遵循微信小程序头像昵称填写规范
- **隐私保护**：OpenID 掩码显示，保护用户隐私
- **扩展性**：为后续云端功能奠定基础

## 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 用户拒绝授权 | 功能降级 | 提供默认头像昵称，不强制授权 |
| OpenID 获取失败 | 身份识别失效 | 生成本地唯一 ID 作为备用方案 |
| 微信 API 变更 | 功能失效 | 使用最新 API，添加兼容性检查 |
| 本地存储限制 | 数据丢失 | 合理设计存储结构，添加数据验证 |

## 成功标准

- ✅ 应用启动时成功获取 OpenID（成功率 > 95%）
- ✅ 用户可以正常选择头像和填写昵称
- ✅ 个人页正确显示用户信息和掩码 OpenID
- ✅ 用户信息在应用重启后正确加载
- ✅ 兼容 H5 和微信小程序平台
- ✅ 符合微信小程序头像昵称填写规范
- ✅ 首次进入个人页时正确显示用户引导提示
- ✅ 用户引导提示关闭后不再重复显示
