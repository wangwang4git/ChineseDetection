# 生字本功能设计文档

## 1. 数据模型

### 1.1 生字本存储结构

```javascript
// storage key: VOCABULARY_NOTEBOOK
{
  chars: ['体', '连', '众', ...],  // 去重后的生字列表
  lastUpdated: 1706000000000       // 最后更新时间戳
}
```

### 1.2 数据来源与更新规则

**初始化规则**：
- 首次访问生字本时，从历史检测记录中提取所有 `unknownChars`
- 对所有记录的不认识汉字进行去重合并

**增量更新规则**：
- **新增**: 每次新测试完成后，将新的 `unknownChars` 合并到生字本（去重）
- **删除**: 用户在生字学习模式中点击"我认识"后，从生字本移除该汉字

### 1.3 统计数据扩展

在个人页统计卡片中新增"生字本"统计：
- 显示当前生字本中的汉字数量
- 点击可跳转到生字本页面

## 2. 页面设计

### 2.1 个人页入口

根据 Figma 设计稿，生字本入口卡片：
- **位置**：在历史记录列表下方，独立一行
- **样式**：白色半透明背景（90%透明度），圆角 32rpx，蓝色边框 (#8EC5FF)
- **布局**：水平布局，左右对齐
- **左侧**：渐变圆形图标（#51A2FF → #C27AFF）+ "生字本"文字
- **右侧**：蓝色渐变胶囊按钮（#2B7FFF → #155DFC），显示生字数量
- 点击跳转：`/pages/vocabulary-notebook/vocabulary-notebook`

### 2.2 生字本页面结构

```
┌─────────────────────────────┐
│  ← 返回                      │  顶部导航
├─────────────────────────────┤
│  📖                         │
│  这里收录了所有不认识的汉字    │  统计卡片
│  共 18 个生字需要学习         │
├─────────────────────────────┤
│  ┌───┐ ┌───┐ ┌───┐ ┌───┐   │
│  │ 体 │ │ 连 │ │ 众 │ │ 少 │   │
│  └───┘ └───┘ └───┘ └───┘   │  生字网格
│  ┌───┐ ┌───┐ ┌───┐ ┌───┐   │  (4 列布局)
│  │ 书 │ │ 五 │ │ 爷 │ │ 越 │   │
│  └───┘ └───┘ └───┘ └───┘   │
│  ...                        │
├─────────────────────────────┤
│  💡 点击汉字可以进行测试学习   │  底部提示
└─────────────────────────────┘
```

### 2.3 生字卡片样式

根据 Figma 设计稿，卡片采用 4 种渐变背景色循环：
1. `linear-gradient(135deg, #FFE5E5 0%, white 100%)` - 粉色
2. `linear-gradient(135deg, #E5F5FF 0%, white 100%)` - 蓝色
3. `linear-gradient(135deg, #FFE5F5 0%, white 100%)` - 粉紫色
4. `linear-gradient(135deg, #FFFBE5 0%, white 100%)` - 黄色

卡片尺寸：`81.37px × 81.37px`（约 `164rpx × 164rpx`）

## 3. 生字学习模式

### 3.1 复用测试页逻辑

当从生字本页面点击汉字进入测试页时：
- 传递参数：`mode=vocabulary-learning&char=汉字`
- 测试页根据 mode 参数切换到学习模式

### 3.2 学习模式与测试模式差异

| 特性 | 测试模式 | 学习模式 |
|------|---------|---------|
| 顶部进度条 | ✅ 显示 | ❌ 隐藏 |
| 熔断机制 | ✅ 启用 | ❌ 禁用 |
| 鼓励语 | ✅ 显示 | ❌ 隐藏 |
| 米字格汉字 | ✅ 显示 | ✅ 显示 |
| 拼音 | ✅ 显示 | ✅ 显示 |
| 词组 | ✅ 显示 | ✅ 显示 |
| 语音播放 | ✅ 显示 | ✅ 显示 |
| 点击"我认识" | 记录并下一个 | 从生字本移除，返回生字本 |
| 点击"不认识" | 记录并下一个 | 保持不变，返回生字本 |
| 完成后 | 跳转结果页 | 返回生字本页面 |

### 3.3 学习模式交互流程

```
生字本页面
    │
    │ 点击汉字卡片
    ▼
测试页（学习模式）
    │
    ├── 点击"我认识"
    │       │
    │       ├── 从生字本移除该汉字
    │       └── navigateBack() 返回生字本
    │
    └── 点击"不认识"
            │
            └── navigateBack() 返回生字本（生字保留）
```

## 4. API 设计

### 4.1 存储层扩展 (storage.js)

```javascript
// 获取生字本
export function getVocabularyNotebook()

// 保存生字本
export function setVocabularyNotebook(notebook)

// 添加生字（去重）
export function addToVocabularyNotebook(chars)

// 从生字本移除
export function removeFromVocabularyNotebook(char)

// 初始化生字本（从历史记录提取）
export function initVocabularyNotebook()
```

### 4.2 record.js 扩展

在 `saveRecord` 后自动调用 `addToVocabularyNotebook` 更新生字本。

## 5. 路由配置

在 `pages.json` 中添加：

```json
{
  "path": "pages/vocabulary-notebook/vocabulary-notebook",
  "style": {
    "navigationBarTitleText": "生字本",
    "navigationStyle": "custom"
  }
}
```

## 6. 实现注意事项

1. **条件编译**: 发音功能仅微信小程序环境可用，使用 `#ifdef MP-WEIXIN`
2. **性能优化**: 生字本数据变化时使用防抖避免频繁写入
3. **空状态处理**: 生字本为空时显示鼓励文案
4. **页面刷新**: 从学习模式返回时，生字本页面需刷新数据
